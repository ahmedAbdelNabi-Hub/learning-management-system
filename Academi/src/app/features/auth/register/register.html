<!-- registration-steps.component.html -->
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8" @fadeInOut>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Your Account</h1>
            <p class="text-gray-600">Join us today and get started in minutes</p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div *ngFor="let step of steps; let i = index"
                    class="flex items-center cursor-pointer transition-all duration-200" (click)="goToStep(step.id)"
                    [class.opacity-50]="step.id > currentStep && !step.completed">

                    <!-- Step Circle -->
                    <div [@stepProgress]="getStepState(i)"
                        class="w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold border-2 border-transparent transition-all duration-200"
                        [ngClass]="{
              'bg-blue-500 border-blue-500': step.id === currentStep,
              'bg-green-500 border-green-500': step.completed,
              'bg-gray-300 border-gray-300': step.id > currentStep && !step.completed
            }">
                        <i *ngIf="!step.completed" class="fas fa-{{step.icon}}"></i>
                        <i *ngIf="step.completed" class="fas fa-check"></i>
                    </div>

                    <!-- Step Title -->
                    <div class="ml-3 text-sm font-medium" [ngClass]="{
                 'text-blue-600': step.id === currentStep,
                 'text-green-600': step.completed,
                 'text-gray-500': step.id > currentStep && !step.completed
               }">
                        {{step.title}}
                    </div>

                    <!-- Connector Line -->
                    <div *ngIf="i < steps.length - 1" class="flex-1 h-1 mx-4 rounded transition-colors duration-200"
                        [ngClass]="{
                 'bg-green-500': step.completed,
                 'bg-gray-300': !step.completed
               }">
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300 ease-out"
                    [style.width.%]="getProgressPercentage()">
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="bg-white rounded-2xl shadow-xl p-8 transition-all duration-300" @slideInOut>

            <!-- Step 1: Personal Information -->
            <div *ngIf="currentStep === 1" @fadeInOut>
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Personal Information</h2>
                <form [formGroup]="personalForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                            <input type="text" formControlName="firstName"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(personalForm, 'firstName')"
                                [class.border-gray-300]="!isFieldInvalid(personalForm, 'firstName')"
                                placeholder="Enter your first name">
                            <p *ngIf="isFieldInvalid(personalForm, 'firstName')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(personalForm, 'firstName')}}
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                            <input type="text" formControlName="lastName"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(personalForm, 'lastName')"
                                [class.border-gray-300]="!isFieldInvalid(personalForm, 'lastName')"
                                placeholder="Enter your last name">
                            <p *ngIf="isFieldInvalid(personalForm, 'lastName')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(personalForm, 'lastName')}}
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" formControlName="dateOfBirth"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(personalForm, 'dateOfBirth')"
                                [class.border-gray-300]="!isFieldInvalid(personalForm, 'dateOfBirth')">
                            <p *ngIf="isFieldInvalid(personalForm, 'dateOfBirth')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(personalForm, 'dateOfBirth')}}
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                            <select formControlName="gender"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(personalForm, 'gender')"
                                [class.border-gray-300]="!isFieldInvalid(personalForm, 'gender')">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                            <p *ngIf="isFieldInvalid(personalForm, 'gender')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(personalForm, 'gender')}}
                            </p>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Step 2: Contact Information -->
            <div *ngIf="currentStep === 2" @fadeInOut>
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Contact Information</h2>
                <form [formGroup]="contactForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                        <input type="email" formControlName="email"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(contactForm, 'email')"
                            [class.border-gray-300]="!isFieldInvalid(contactForm, 'email')"
                            placeholder="Enter your email address">
                        <p *ngIf="isFieldInvalid(contactForm, 'email')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(contactForm, 'email')}}
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="tel" formControlName="phone"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(contactForm, 'phone')"
                            [class.border-gray-300]="!isFieldInvalid(contactForm, 'phone')"
                            placeholder="Enter your phone number">
                        <p *ngIf="isFieldInvalid(contactForm, 'phone')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(contactForm, 'phone')}}
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Alternate Email (Optional)</label>
                        <input type="email" formControlName="alternateEmail"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(contactForm, 'alternateEmail')"
                            [class.border-gray-300]="!isFieldInvalid(contactForm, 'alternateEmail')"
                            placeholder="Enter alternate email address">
                        <p *ngIf="isFieldInvalid(contactForm, 'alternateEmail')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(contactForm, 'alternateEmail')}}
                        </p>
                    </div>
                </form>
            </div>

            <!-- Step 3: Security -->
            <div *ngIf="currentStep === 3" @fadeInOut>
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Security Settings</h2>
                <form [formGroup]="securityForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" formControlName="password"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(securityForm, 'password')"
                            [class.border-gray-300]="!isFieldInvalid(securityForm, 'password')"
                            placeholder="Enter your password">
                        <p *ngIf="isFieldInvalid(securityForm, 'password')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(securityForm, 'password')}}
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                        <input type="password" formControlName="confirmPassword"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(securityForm, 'confirmPassword') || securityForm.hasError('passwordMismatch')"
                            [class.border-gray-300]="!isFieldInvalid(securityForm, 'confirmPassword') && !securityForm.hasError('passwordMismatch')"
                            placeholder="Confirm your password">
                        <p *ngIf="isFieldInvalid(securityForm, 'confirmPassword') || securityForm.hasError('passwordMismatch')"
                            class="mt-1 text-sm text-red-500">
                            {{securityForm.hasError('passwordMismatch') ? 'Passwords do not match' :
                            getFieldError(securityForm, 'confirmPassword')}}
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Security Question</label>
                        <select formControlName="securityQuestion"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(securityForm, 'securityQuestion')"
                            [class.border-gray-300]="!isFieldInvalid(securityForm, 'securityQuestion')">
                            <option value="">Select a security question</option>
                            <option value="pet">What was the name of your first pet?</option>
                            <option value="school">What was the name of your elementary school?</option>
                            <option value="city">In what city were you born?</option>
                            <option value="mother">What is your mother's maiden name?</option>
                        </select>
                        <p *ngIf="isFieldInvalid(securityForm, 'securityQuestion')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(securityForm, 'securityQuestion')}}
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Security Answer</label>
                        <input type="text" formControlName="securityAnswer"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(securityForm, 'securityAnswer')"
                            [class.border-gray-300]="!isFieldInvalid(securityForm, 'securityAnswer')"
                            placeholder="Enter your answer">
                        <p *ngIf="isFieldInvalid(securityForm, 'securityAnswer')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(securityForm, 'securityAnswer')}}
                        </p>
                    </div>
                </form>
            </div>

            <!-- Step 4: Address -->
            <div *ngIf="currentStep === 4" @fadeInOut>
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Address Information</h2>
                <form [formGroup]="addressForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                        <input type="text" formControlName="street"
                            class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [class.border-red-500]="isFieldInvalid(addressForm, 'street')"
                            [class.border-gray-300]="!isFieldInvalid(addressForm, 'street')"
                            placeholder="Enter your street address">
                        <p *ngIf="isFieldInvalid(addressForm, 'street')" class="mt-1 text-sm text-red-500">
                            {{getFieldError(addressForm, 'street')}}
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                            <input type="text" formControlName="city"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(addressForm, 'city')"
                                [class.border-gray-300]="!isFieldInvalid(addressForm, 'city')"
                                placeholder="Enter your city">
                            <p *ngIf="isFieldInvalid(addressForm, 'city')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(addressForm, 'city')}}
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                            <input type="text" formControlName="state"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(addressForm, 'state')"
                                [class.border-gray-300]="!isFieldInvalid(addressForm, 'state')"
                                placeholder="Enter your state">
                            <p *ngIf="isFieldInvalid(addressForm, 'state')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(addressForm, 'state')}}
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                            <input type="text" formControlName="zipCode"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(addressForm, 'zipCode')"
                                [class.border-gray-300]="!isFieldInvalid(addressForm, 'zipCode')"
                                placeholder="Enter ZIP code">
                            <p *ngIf="isFieldInvalid(addressForm, 'zipCode')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(addressForm, 'zipCode')}}
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                            <select formControlName="country"
                                class="w-full px-4 py-3 rounded-lg border transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="isFieldInvalid(addressForm, 'country')"
                                [class.border-gray-300]="!isFieldInvalid(addressForm, 'country')">
                                <option value="">Select Country</option>
                                <option value="us">United States</option>
                                <option value="ca">Canada</option>
                                <option value="uk">United Kingdom</option>
                                <option value="au">Australia</option>
                                <option value="other">Other</option>
                            </select>
                            <p *ngIf="isFieldInvalid(addressForm, 'country')" class="mt-1 text-sm text-red-500">
                                {{getFieldError(addressForm, 'country')}}
                            </p>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                <button *ngIf="currentStep > 1" (click)="prevStep()"
                    class="flex items-center px-6 py-3 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors duration-200 font-medium">
                    <i class="fas fa-chevron-left mr-2"></i>
                    Previous
                </button>
                <div *ngIf="currentStep === 1"></div>

                <button *ngIf="currentStep < totalSteps" (click)="nextStep()"
                    class="flex items-center px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium ml-auto">
                    Next
                    <i class="fas fa-chevron-right ml-2"></i>
                </button>

                <button *ngIf="currentStep === totalSteps" (click)="onSubmit()" [disabled]="isSubmitting"
                    class="flex items-center px-8 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 font-medium ml-auto disabled:opacity-50 disabled:cursor-not-allowed">
                    <span *ngIf="!isSubmitting">Complete Registration</span>
                    <span *ngIf="isSubmitting" class="flex items-center">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        Processing...
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>